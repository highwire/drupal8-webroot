<?php

namespace HighWire\Clients\Personalization;

use Psr\Http\Message\RequestInterface;


/**
 * Right now the personalizatino client generated by swagger adds json content type headers
 * to POST request and other crud request. As a temporary work around until we can make it not
 * do that, this trait remove the header before making the request.
 */
trait RemoveHeaderTrait {

  /**
   * Guzzle middlewear method to remove json content type header.
   */
  public function removeJSONContentTypeHeader() {
    return function (callable $handler) {
      return function (
        RequestInterface $request,
        array $options
      ) use ($handler) {
        if ($request->getMethod() != "GET") {
          if (empty($request->getBody()) || $request->getBody()->getSize() == 0) {
            $request = $request->withoutHeader("Content-Type");
          }
        }

        return $handler($request, $options);
      };
    };
  }

}
